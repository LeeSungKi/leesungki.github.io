{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/gatsby-aws-history-of-opensearch-tuto/",
    "result": {"data":{"cur":{"id":"e8b51a6b-4d91-5673-b820-87361c7b1bd8","html":"<h2 id=\"-개요\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EC%9A%94\" aria-label=\" 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎈 개요</h2>\n<p>내가 진행한 프로젝트 에서 검색 엔진으로 오픈서치를 선택하여 사용해야하는 상황이 있었다.\r\n해당 부분은 사실 인프라에서 진행하였지만 진행중 공부한 내용들을 기재 하려한다.\r\n이번 글에서는 간단하게 도메인 생성과 키바나접속등 기본적인 내용만 다룰 예정이다.</p>\n<h2 id=\"-amazon-opensearch-service-시작하기\" style=\"position:relative;\"><a href=\"#-amazon-opensearch-service-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\" aria-label=\" amazon opensearch service 시작하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🚀 Amazon OpenSearch Service 시작하기</h2>\n<p>Amazon OpenSearch Service를 사용하여 테스트 도메인을 만들고 구성하는 방법을 진행해 보자</p>\n<p>OpenSearch Service 도메인은 OpenSearch 클러스터와 동의어입니다.</p>\n<p>도메인은 설정, 인스턴스 유형, 인스턴스 수, 스토리지 리소스를 지정한 설정입니다.</p>\n<h3 id=\"-1단계-opensearch-service-도메인-생성\" style=\"position:relative;\"><a href=\"#-1%EB%8B%A8%EA%B3%84-opensearch-service-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%83%9D%EC%84%B1\" aria-label=\" 1단계 opensearch service 도메인 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🦖 1단계: OpenSearch Service 도메인 생성</h3>\n<p><strong>콘솔을 사용하여 OpenSearch Service 도메인을 만들려면</strong></p>\n<ol>\n<li>\n<p><a href=\"https://aws.amazon.com%EC%9C%BC%EB%A1%9C\">https://aws.amazon.com으로</a> 이동하여 콘솔에 로그인(Sign In to the Console)을 선택합니다.</p>\n</li>\n<li>\n<p>분석(Analytics)에서 Amazon OpenSearch Service를 선택합니다.</p>\n</li>\n<li>\n<p>[도메인 생성(Create domain)]을 선택합니다.</p>\n</li>\n</ol>\n<p><img src=\"/e2013156ab25d5c6f8cd1f86868aabbc/es0.png\" alt=\"es0.PNG\"></p>\n<ol start=\"4\">\n<li>도메인의 이름을 입력합니다. 나는 movies라는 이름을 사용</li>\n</ol>\n<p><img src=\"/131adf9dd3529310c06f51ba0c6aec37/es1.png\" alt=\"es1.PNG\"></p>\n<ol start=\"5\">\n<li>\n<p>사용자 지정 엔드포인트(Custom endpoint) 설정을 무시합니다.</p>\n</li>\n<li>\n<p>배포 유형은 개발 및 테스트(Development and testing)를 선택합니다.</p>\n</li>\n</ol>\n<p><img src=\"/5407e01d29ca0303b75d2233c01422c2/es2.png\" alt=\"es2.PNG\"></p>\n<ol start=\"7\">\n<li>\n<p>버전(Version)에서 최신 버전을 선택합니다.</p>\n</li>\n<li>\n<p>데이터 노드(Data nodes)에서 인스턴스 유형을 t3.small.search로 변경하고 세 개의 노드 기본값을 유지합니다.</p>\n</li>\n</ol>\n<p><img src=\"/6f5163f11bd6b5a28b0b0e67659175a7/es3.png\" alt=\"es3.PNG\"></p>\n<ol start=\"9\">\n<li>간단한 확인을 위해 퍼블릭 액세스 도메인을 사용합니다. [네트워크(Network)]에서 [퍼블릭 액세스(Public access)]를 선택합니다.</li>\n</ol>\n<p><img src=\"/4ec8c8c37a8726e06965e0e3cabecafe/es4.png\" alt=\"es4.PNG\"></p>\n<ol start=\"10\">\n<li>세분화된 액세스 제어 설정에서 마스터 사용자 생성(Create master user)을 선택합니다. 사용자 이름과 암호를 입력합니다.</li>\n</ol>\n<p><img src=\"/3a489533a7fc8516a83b6f193f09b9ac/es5.png\" alt=\"es5.PNG\"></p>\n<ol start=\"11\">\n<li>\n<p>지금은SAML 인증 및 Amazon Cognito 인증 섹션을 무시합니다.</p>\n</li>\n<li>\n<p>[액세스 정책(Access policy)]에서 [세분화된 액세스 제어만 사용(Only use fine-grained access control)]을 선택합니다. 이 자습서에서는 세분화된 액세스 제어를 통해 도메인 액세스 정책이 아닌 인증을 처리합니다.</p>\n</li>\n</ol>\n<p><img src=\"/c2954ccd4067510f3dfad27df3d85abc/es6.png\" alt=\"es6.PNG\"></p>\n<ol start=\"13\">\n<li>나머지 설정은 무시하고 [생성(Create)]을 선택합니다. 새 도메인은 일반적으로 초기화하는 데 15~30분 정도 걸리지만 구성에 따라 시간이 더 오래 걸릴 수 있습니다. 도메인이 초기화된 후 엔드포인트를 기록해 둡니다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAuUlEQVQY021OSw6CMBDlwnAD0LDAA5AYFireQKJHwpWxKe20aWfagikiYeHLW7yZN5+X9P3z9WZKa1DqP2HmrCWAkHIQgnHOhyHhnGutvffkIhCR6CsjLKJzzrvFI2vDuAARk7gZwvSDlAKJ1pIJGJQOYZymiazd53maZWmWHarKIiZCSsYYAIQxTjjvtreMtaCU87ETiI51XRS7siybpomfY0Tv15xRb8uNS0Td/XE6t5f22nU3Y8wHzC0UJmoiPMgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"es7.png\"\n        title=\"es7.png\"\n        src=\"/static/f87244c100b46f96d111fddc240b1598/37523/es7.png\"\n        srcset=\"/static/f87244c100b46f96d111fddc240b1598/e9ff0/es7.png 180w,\n/static/f87244c100b46f96d111fddc240b1598/f21e7/es7.png 360w,\n/static/f87244c100b46f96d111fddc240b1598/37523/es7.png 720w,\n/static/f87244c100b46f96d111fddc240b1598/302a4/es7.png 1080w,\n/static/f87244c100b46f96d111fddc240b1598/07a9c/es7.png 1440w,\n/static/f87244c100b46f96d111fddc240b1598/891d5/es7.png 1520w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol start=\"14\">\n<li>Kibana URL 을 통해 키바나 접속가능</li>\n</ol>\n<p><img src=\"/d4aa3f74498c6f013967822574f32929/es8.png\" alt=\"es8.PNG\"></p>\n<h3 id=\"-2단계-인덱싱을-위해-데이터-업로드\" style=\"position:relative;\"><a href=\"#-2%EB%8B%A8%EA%B3%84-%EC%9D%B8%EB%8D%B1%EC%8B%B1%EC%9D%84-%EC%9C%84%ED%95%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\" 2단계 인덱싱을 위해 데이터 업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🐻 2단계: 인덱싱을 위해 데이터 업로드</h3>\n<p><strong>옵션 1: 단일 문서 업로드</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -X PUT -u '접근유저명:패스워드' '앤드포인트/movies/_doc/1' -d \"{\\\"director\\\": \\\"Burton, Tim\\\", \\\"genre\\\": [\\\"Comedy\\\",\\\"Sci-Fi\\\"], \\\"year\\\": 1996, \\\"actor\\\": [\\\"Jack Nicholson\\\",\\\"Pierce Brosnan\\\",\\\"Sarah Jessica Parker\\\"], \\\"title\\\": \\\"Mars Attacks!\\\"}\" -H Content-Type:application/json</code></pre></div>\n<p><strong>옵션 2: 여러 문서 업로드</strong></p>\n<p>bulk_movies.json 이라는 로컬 파일을 생성합니다. 다음 내용을 파일에 복사하여 붙여넣고, 후행 줄바꿈을 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token property\">\"index\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"movies\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"director\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Frankenheimer, John\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"genre\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Drama\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Mystery\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thriller\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Crime\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"year\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1962</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"actor\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Lansbury, Angela\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sinatra, Frank\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Leigh, Janet\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Harvey, Laurence\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Silva, Henry\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Frees, Paul\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Gregory, James\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bissell, Whit\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"McGiver, John\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Parrish, Leslie\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Edwards, James\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Flowers, Bess\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Dhiegh, Khigh\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Payne, Julie\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Kleeb, Helen\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Gray, Joe\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Nalder, Reggie\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Stevens, Bert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Masters, Michael\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Lowell, Tom\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The Manchurian Candidate\"</span><span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">{</span> <span class=\"token property\">\"index\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"movies\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"director\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Baird, Stuart\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"genre\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Action\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Crime\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thriller\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"year\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1998</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"actor\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Downey Jr., Robert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Jones, Tommy Lee\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Snipes, Wesley\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Pantoliano, Joe\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Jacob, Ir\\u00e8ne\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Nelligan, Kate\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Roebuck, Daniel\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Malahide, Patrick\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Richardson, LaTanya\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wood, Tom\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Kosik, Thomas\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Stellate, Nick\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Minkoff, Robert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Brown, Spitfire\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Foster, Reese\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Spielbauer, Bruce\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Mukherji, Kevin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Cray, Ed\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Fordham, David\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Jett, Charlie\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"U.S. Marshals\"</span><span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">{</span> <span class=\"token property\">\"index\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"movies\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"_id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"4\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">{</span><span class=\"token property\">\"director\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Ray, Nicholas\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"genre\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Drama\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Romance\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"year\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1955</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"actor\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Hopper, Dennis\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wood, Natalie\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Dean, James\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Mineo, Sal\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Backus, Jim\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Platt, Edward\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Ray, Nicholas\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hopper, William\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Allen, Corey\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Birch, Paul\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hudson, Rochelle\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Doran, Ann\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hicks, Chuck\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Leigh, Nelson\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Williams, Robert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wessel, Dick\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bryar, Paul\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sessions, Almira\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"McMahon, David\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Peters Jr., House\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Rebel Without a Cause\"</span><span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>파일이 저장되는 로컬 디렉터리에서 다음 명령을 실행하여 movies 도메인에 파일을 업로드합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XPOST -u master-user:master-user-password domain-endpoint/_bulk --data-binary @bulk_movies.json -H Content-Type:application/json</code></pre></div>\n<h3 id=\"-3단계-opensearch-service에서-문서-검색\" style=\"position:relative;\"><a href=\"#-3%EB%8B%A8%EA%B3%84-opensearch-service%EC%97%90%EC%84%9C-%EB%AC%B8%EC%84%9C-%EA%B2%80%EC%83%89\" aria-label=\" 3단계 opensearch service에서 문서 검색 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💻 3단계: OpenSearch Service에서 문서 검색</h3>\n<p>Amazon OpenSearch Service 도메인에서 문서를 검색하려면 OpenSearch 검색 API를 사용합니다.</p>\n<p><strong>명령줄에서 문서 검색</strong></p>\n<p>다음 명령을 실행하여 movies 도메인에서 mars를 검색합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -XGET -u master-user:master-user-password domain-endpoint/movies/_search?q=mars</code></pre></div>\n<p><strong>Kibana에서 검색</strong></p>\n<p>Query Workbench 클릭</p>\n<p><img src=\"/8dffbba3e36ab212e4bd93fcfe35c263/es9.png\" alt=\"es9.PNG\"></p>\n<p>Query editor 에 아래의 쿼리 RUN</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> movies<span class=\"token punctuation\">;</span></code></pre></div>\n<p>데이터 확인</p>\n<p><img src=\"/dc7d8e2ee305356550ff29e02ca0e9da/es10.png\" alt=\"es10.PNG\"></p>\n<h3 id=\"-4단계-opensearch-service-도메인-삭제\" style=\"position:relative;\"><a href=\"#-4%EB%8B%A8%EA%B3%84-opensearch-service-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%82%AD%EC%A0%9C\" aria-label=\" 4단계 opensearch service 도메인 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚱ 4단계: OpenSearch Service 도메인 삭제</h3>\n<p><strong>콘솔에서 OpenSearch Service 도메인을 삭제하려면</strong></p>\n<p>Amazon OpenSearch Service 콘솔에 로그인합니다.</p>\n<p>[도메인(Domains)]에서 movies 도메인을 선택합니다.</p>\n<p>[삭제(Delete)]를 선택하고 삭제 의사를 확인합니다.</p>\n<h2 id=\"-느낀점\" style=\"position:relative;\"><a href=\"#-%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\" 느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎢 느낀점</h2>\n<p>아마 오픈서치를 사용하는 사람이라면 키바나의 기능을 제공하는것에 감사함을 느끼며 키바나를 활용을 많이 할듯싶다..</p>\n<p>콘솔로도 가능한 기능들이 맞지만 확실히 쿼리에 익숙한 사람이라면 키바나를 사용하는걸 추천한다.</p>\n<p>그리고 요번 튜토리얼에는 퍼블릭으로 도메인을 생성하여서 간단하게 테스트 했지만 실제 프로젝트에서 vpc 엑세스를 권장한다</p>\n<p>다음에는 스프링 부트에서 오픈서치를 사용하는 방법을 포스팅할 예정이다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EA%B0%9C%EC%9A%94\">🎈 개요</a></p>\n</li>\n<li>\n<p><a href=\"#-amazon-opensearch-service-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\">🚀 Amazon OpenSearch Service 시작하기</a></p>\n<ul>\n<li><a href=\"#-1%EB%8B%A8%EA%B3%84-opensearch-service-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%83%9D%EC%84%B1\">🦖 1단계: OpenSearch Service 도메인 생성</a></li>\n<li><a href=\"#-2%EB%8B%A8%EA%B3%84-%EC%9D%B8%EB%8D%B1%EC%8B%B1%EC%9D%84-%EC%9C%84%ED%95%B4-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%85%EB%A1%9C%EB%93%9C\">🐻 2단계: 인덱싱을 위해 데이터 업로드</a></li>\n<li><a href=\"#-3%EB%8B%A8%EA%B3%84-opensearch-service%EC%97%90%EC%84%9C-%EB%AC%B8%EC%84%9C-%EA%B2%80%EC%83%89\">💻 3단계: OpenSearch Service에서 문서 검색</a></li>\n<li><a href=\"#-4%EB%8B%A8%EA%B3%84-opensearch-service-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%82%AD%EC%A0%9C\">⚱ 4단계: OpenSearch Service 도메인 삭제</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%8A%90%EB%82%80%EC%A0%90\">🎢 느낀점</a></p>\n</li>\n</ul>\n</div>","excerpt":"🎈 개요 내가 진행한 프로젝트 에서 검색 엔진으로 오픈서치를 선택하여 사용해야하는 상황이 있었다.\r\n해당 부분은 사실 인프라에서 진행하였지만 진행중 공부한 내용들을 기재 하려한다.\r\n이번 글에서는 간단하게 도메인 생성과 키바나접속등 기본적인 내용만 다룰 예정이다. 🚀 Amazon OpenSearch Service 시작하기 Amazon OpenSearch Service를 사용하여 테스트 도메인을 만들고 구성하는 방법을 진행해 보자 OpenSearch Service 도메인은 OpenSearch 클러스터와 동의어입니다. 도메인은 설정, 인스턴스 유형, 인스턴스 수, 스토리지 리소스를 지정한 설정입니다. 🦖 1단계: OpenSearch Service 도메인 생성 콘솔을 사용하여 OpenSearch Service 도메인을 만들려면 https://aws.amazon.com으로 이동하여 콘솔에 로그인(Sign In to the Console)을 선택합니다. 분석(Analytics)에서 Amaz…","frontmatter":{"date":"March 14, 2022","title":"AWS OpenSearch(Elasticsearch) 사용법","categories":"aws","author":"쩡기","emoji":"🎄"},"fields":{"slug":"/gatsby-aws-history-of-opensearch-tuto/"}},"next":{"id":"136a57ae-d20e-5e57-bac2-04fab231266b","html":"<h2 id=\"-opensearch란-무엇입니까\" style=\"position:relative;\"><a href=\"#-opensearch%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9E%85%EB%8B%88%EA%B9%8C\" aria-label=\" opensearch란 무엇입니까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎈 OpenSearch란 무엇입니까?</h2>\n<p>OpenSearch는 배포형 오픈 소스 검색과 분석 제품군으로 실시간 애플리케이션 모니터링, 로그 분석 및 웹 사이트 검색과 같이 다양한 사용 사례에 사용됩니다. OpenSearch는 데이터 탐색을 쉽게 도와주는 통합 시각화 도구 OpenSearch와 함께 뛰어난 확장성을 지닌 시스템을 제공하여 대량 데이터 볼륨에 빠르게 액세스 및 응답합니다. Elasticsearch 및 Apache Solr와 마찬가지로 OpenSearch는 Apache Lucene 검색 라이브러리를 사용합니다. OpenSearch 및 OpenSearch 대시보드는 Elasticsearch 7.10.2 및 Kibana 7.10.2에서 파생되었습니다.</p>\n<h2 id=\"-opensearch가-만들어진-이유는-무엇인가요\" style=\"position:relative;\"><a href=\"#-opensearch%EA%B0%80-%EB%A7%8C%EB%93%A4%EC%96%B4%EC%A7%84-%EC%9D%B4%EC%9C%A0%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%9A%94\" aria-label=\" opensearch가 만들어진 이유는 무엇인가요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🚀 OpenSearch가 만들어진 이유는 무엇인가요?</h2>\n<p>Elastic은 Elastic License 또는 Server Side Public License(SSPL) 하에서 사용할 수 있는 소스 코드를 사용하여 Elastic License 하에서 Elasticsearch 및 Kibana를 릴리스했습니다. 해당 라이선스는 오픈 소스가 아니며 사용자에게 동일한 자유를 제공하지 않습니다. 이 때문에 AWS는 마지막 ALv2 버전의 Elasticsearch 및 Kibana에서 갈래를 생성하고 유지 관리하기로 결정했습니다. 그 갈래는 OpenSearch라고 부르며 ALv2 아래에서 사용할 수 있습니다.</p>\n<h2 id=\"-opensearch를-사용해야-하는-이유는-무엇입니까\" style=\"position:relative;\"><a href=\"#-opensearch%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9E%85%EB%8B%88%EA%B9%8C\" aria-label=\" opensearch를 사용해야 하는 이유는 무엇입니까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🦖 OpenSearch를 사용해야 하는 이유는 무엇입니까?</h2>\n<p>OpenSearch를 사용하면 데이터를 쉽게 수집, 보안, 검색, 집계, 확인, 분석할 수 있습니다. 이런 기능은 애플리케이션 검색, 로그 분석 등의 사용 사례에서 인기가 있습니다. OpenSearch가 있으면 원하는 방식으로 사용, 수정, 확장, 수익화, 재판매할 수 있다는 오픈 소스 제품의 이점을 누릴 수 있습니다. 동시에 당사는 계속해서 새롭고 혁신적인 기능의 풍부한 로드맵을 지닌 안전하고 높은 품질의 검색 및 분석 제품군을 제공할 것입니다.</p>\n<h2 id=\"-느낀점\" style=\"position:relative;\"><a href=\"#-%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\" 느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎢 느낀점</h2>\n<p>Amazon OpenSearch Service 에서 OpenSearch를 사용 할수 있는데 OpenSearch는 Elasticsearch 기반 인거 같다.\r\nElasticsearch에 대해서는 다음 글을 참고하자 <a href=\"https://leesungki.github.io/gatsby-aws-history-of-elasticsearch\">링크</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#-opensearch%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9E%85%EB%8B%88%EA%B9%8C\">🎈 OpenSearch란 무엇입니까?</a></li>\n<li><a href=\"#-opensearch%EA%B0%80-%EB%A7%8C%EB%93%A4%EC%96%B4%EC%A7%84-%EC%9D%B4%EC%9C%A0%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%9A%94\">🚀 OpenSearch가 만들어진 이유는 무엇인가요?</a></li>\n<li><a href=\"#-opensearch%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9E%85%EB%8B%88%EA%B9%8C\">🦖 OpenSearch를 사용해야 하는 이유는 무엇입니까?</a></li>\n<li><a href=\"#-%EB%8A%90%EB%82%80%EC%A0%90\">🎢 느낀점</a></li>\n</ul>\n</div>","frontmatter":{"date":"March 14, 2022","title":"OpenSearch 란?","categories":"aws","author":"쩡기","emoji":"🎄"},"fields":{"slug":"/gatsby-aws-history-of-opensearch/"}},"prev":{"id":"41c2558a-1ae4-5d84-85f0-aff57f54bf7a","html":"<h2 id=\"-개요\" style=\"position:relative;\"><a href=\"#-%EA%B0%9C%EC%9A%94\" aria-label=\" 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✅ 개요</h2>\n<p>AWS 의 OpenSearch에 접근하여 데이터를 생성해보자.</p>\n<blockquote>\n<p>Aws OpenSearch(Elasticsearch) 관련 포스팅은 <a href=\"https://leesungki.github.io/gatsby-aws-history-of-opensearch-tuto\">여기</a>를 참고하자</p>\n</blockquote>\n<h3 id=\"aws-opensearch-연동\" style=\"position:relative;\"><a href=\"#aws-opensearch-%EC%97%B0%EB%8F%99\" aria-label=\"aws opensearch 연동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS OpenSearch 연동</h3>\n<p>기본 프로젝트 구조</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">infra\r\n    ㄴaws\r\n        ㄴAWSRequestSigningApacheInterceptor\r\ncontroller\r\n    ㄴDataCheckController        </code></pre></div>\n<ol>\n<li>의존성 추가</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dependencies {    \r\n    implementation group: 'org.opensearch.client', name: 'opensearch-rest-high-level-client', version: '1.2.4'\r\n}</code></pre></div>\n<ol start=\"2\">\n<li>AWSRequestSigningApacheInterceptor 추가</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\r\n * An {@link HttpRequestInterceptor} that signs requests using any AWS {@link Signer}\r\n * and {@link AWSCredentialsProvider}.\r\n */</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AWSRequestSigningApacheInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">HttpRequestInterceptor</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">/**\r\n     * The service that we're connecting to. Technically not necessary.\r\n     * Could be used by a future Signer, though.\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> service<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">/**\r\n     * The particular signer implementation.\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Signer</span> signer<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">/**\r\n     * The source of AWS credentials for signing.\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AWSCredentialsProvider</span> awsCredentialsProvider<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">/**\r\n     *\r\n     * @param service service that we're connecting to\r\n     * @param signer particular signer implementation\r\n     * @param awsCredentialsProvider source of AWS credentials for signing\r\n     */</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AWSRequestSigningApacheInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> service<span class=\"token punctuation\">,</span>\r\n                                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">Signer</span> signer<span class=\"token punctuation\">,</span>\r\n                                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">AWSCredentialsProvider</span> awsCredentialsProvider<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>service <span class=\"token operator\">=</span> service<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>signer <span class=\"token operator\">=</span> signer<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>awsCredentialsProvider <span class=\"token operator\">=</span> awsCredentialsProvider<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token comment\">/**\r\n     * {@inheritDoc}\r\n     */</span>\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpContext</span> context<span class=\"token punctuation\">)</span>\r\n            <span class=\"token keyword\">throws</span> <span class=\"token class-name\">HttpException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">URIBuilder</span> uriBuilder<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n            uriBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URIBuilder</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">URISyntaxException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid URI\"</span> <span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// Copy Apache HttpRequest to AWS DefaultRequest</span>\r\n        <span class=\"token class-name\">DefaultRequest</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> signableRequest <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultRequest</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token class-name\">HttpHost</span> host <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpHost</span><span class=\"token punctuation\">)</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span>HTTP_TARGET_HOST<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>host <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setEndpoint</span><span class=\"token punctuation\">(</span>URI<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">.</span><span class=\"token function\">toURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpMethodName</span> httpMethod <span class=\"token operator\">=</span>\r\n                <span class=\"token class-name\">HttpMethodName</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromValue</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setHttpMethod</span><span class=\"token punctuation\">(</span>httpMethod<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n            signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setResourcePath</span><span class=\"token punctuation\">(</span>uriBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRawPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">URISyntaxException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid URI\"</span> <span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">HttpEntityEnclosingRequest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">HttpEntityEnclosingRequest</span> httpEntityEnclosingRequest <span class=\"token operator\">=</span>\r\n                    <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpEntityEnclosingRequest</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpEntityEnclosingRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ByteArrayInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n                signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>httpEntityEnclosingRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setParameters</span><span class=\"token punctuation\">(</span><span class=\"token function\">nvpToMapParams</span><span class=\"token punctuation\">(</span>uriBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setHeaders</span><span class=\"token punctuation\">(</span><span class=\"token function\">headerArrayToMap</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getAllHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// Sign it</span>\r\n        signer<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span>signableRequest<span class=\"token punctuation\">,</span> awsCredentialsProvider<span class=\"token punctuation\">.</span><span class=\"token function\">getCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// Now copy everything back</span>\r\n        request<span class=\"token punctuation\">.</span><span class=\"token function\">setHeaders</span><span class=\"token punctuation\">(</span><span class=\"token function\">mapToHeaderArray</span><span class=\"token punctuation\">(</span>signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">HttpEntityEnclosingRequest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">HttpEntityEnclosingRequest</span> httpEntityEnclosingRequest <span class=\"token operator\">=</span>\r\n                    <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpEntityEnclosingRequest</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>httpEntityEnclosingRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token class-name\">BasicHttpEntity</span> basicHttpEntity <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicHttpEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                basicHttpEntity<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>signableRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                httpEntityEnclosingRequest<span class=\"token punctuation\">.</span><span class=\"token function\">setEntity</span><span class=\"token punctuation\">(</span>basicHttpEntity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token comment\">/**\r\n     *\r\n     * @param params list of HTTP query params as NameValuePairs\r\n     * @return a multimap of HTTP query params\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">nvpToMapParams</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">NameValuePair</span><span class=\"token punctuation\">></span></span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> parameterMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TreeMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>CASE_INSENSITIVE_ORDER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NameValuePair</span> nvp <span class=\"token operator\">:</span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> argsList <span class=\"token operator\">=</span>\r\n                    parameterMap<span class=\"token punctuation\">.</span><span class=\"token function\">computeIfAbsent</span><span class=\"token punctuation\">(</span>nvp<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> k <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            argsList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>nvp<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> parameterMap<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token comment\">/**\r\n     * @param headers modeled Header objects\r\n     * @return a Map of header entries\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">headerArrayToMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Header</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> headers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> headersMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TreeMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>CASE_INSENSITIVE_ORDER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Header</span> header <span class=\"token operator\">:</span> headers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">skipHeader</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                headersMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> header<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> headersMap<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token comment\">/**\r\n     * @param header header line to check\r\n     * @return true if the given header should be excluded when signing\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">skipHeader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Header</span> header<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"content-length\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Strip Content-Length: 0</span>\r\n                <span class=\"token operator\">||</span> <span class=\"token string\">\"host\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Host comes from endpoint</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token comment\">/**\r\n     * @param mapHeaders Map of header entries\r\n     * @return modeled Header objects\r\n     */</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Header</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">mapToHeaderArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> mapHeaders<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Header</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> headers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Header</span><span class=\"token punctuation\">[</span>mapHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> headerEntry <span class=\"token operator\">:</span> mapHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            headers<span class=\"token punctuation\">[</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicHeader</span><span class=\"token punctuation\">(</span>headerEntry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> headerEntry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> headers<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://github.com/amazon-archives/aws-request-signing-apache-interceptor\">참고</a></p>\n<ol start=\"3\">\n<li>DataCheckController</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\r\n<span class=\"token annotation punctuation\">@RestController</span>\r\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/v1\"</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DataCheckController</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">/**\r\n     * aws 가용 지역\r\n     */</span>\r\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${cloud.aws.region.static}\"</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> region<span class=\"token punctuation\">;</span><span class=\"token comment\">//ap-northeast-2 서울리전</span>\r\n\r\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/search1\"</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">search1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\r\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------------------->search1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">RestHighLevelClient</span> searchClient <span class=\"token operator\">=</span> <span class=\"token function\">searchClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// Create the document as a hash map</span>\r\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> document <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Walk the Line\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"director\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"James Mangold\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"year\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2005\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------------------->Map\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// Form the indexing request, send it, and print the response</span>\r\n        <span class=\"token class-name\">IndexRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my-index\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">IndexResponse</span> response <span class=\"token operator\">=</span> searchClient<span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RequestOptions</span><span class=\"token punctuation\">.</span>DEFAULT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response=========>\"</span><span class=\"token operator\">+</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response Result=========>\"</span><span class=\"token operator\">+</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> serviceName <span class=\"token operator\">=</span> <span class=\"token string\">\"es\"</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> host <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// e.g. https://search-mydomain.us-west-1.es.amazonaws.com 앤드포인트</span>\r\n\r\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AWSCredentialsProvider</span> credentialsProvider <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultAWSCredentialsProviderChain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RestHighLevelClient</span> <span class=\"token function\">searchClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"------------------------------------->RestHighLevelClient\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">AWS4Signer</span> signer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS4Signer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        signer<span class=\"token punctuation\">.</span><span class=\"token function\">setServiceName</span><span class=\"token punctuation\">(</span>serviceName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        signer<span class=\"token punctuation\">.</span><span class=\"token function\">setRegionName</span><span class=\"token punctuation\">(</span>region<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">HttpRequestInterceptor</span> interceptor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWSRequestSigningApacheInterceptor</span><span class=\"token punctuation\">(</span>serviceName<span class=\"token punctuation\">,</span> signer<span class=\"token punctuation\">,</span> credentialsProvider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestHighLevelClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RestClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpHost</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setHttpClientConfigCallback</span><span class=\"token punctuation\">(</span>hacb <span class=\"token operator\">-></span> hacb<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptorLast</span><span class=\"token punctuation\">(</span>interceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>   \r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"4\">\n<li>포스트맨 호출</li>\n</ol>\n<p><img src=\"/1c399e99d3045f45524e33758357817b/sbes1.png\" alt=\"sbes1.PNG\"></p>\n<ol start=\"5\">\n<li>키바나 확인</li>\n</ol>\n<p><img src=\"/d6c68d61e4c9a5620163f5436167349d/sbes2.png\" alt=\"sbes2.PNG\"></p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌭마무리</h2>\n<p>위와 같이 springboot에서 OpenSearch(Elasticsearch)에 인덱스를 생성해주었고 확인까지 할수 있었다.</p>\n<p>다음에는 OpenSearch(Elasticsearch)에 있는 데이터를 검색을 해보자.</p>\n<br>\r\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EA%B0%9C%EC%9A%94\">✅ 개요</a></p>\n<ul>\n<li><a href=\"#aws-opensearch-%EC%97%B0%EB%8F%99\">AWS OpenSearch 연동</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">🌭마무리</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"March 15, 2022","title":"Spring Boot + Aws OpenSearch(Elasticsearch) 연동","categories":"SpringBoot","author":"쩡기","emoji":"🧙‍♂️"},"fields":{"slug":"/gatsby-springboot-study-opensearch/"}},"site":{"siteMetadata":{"siteUrl":"https://leesungki.github.io","comments":{"utterances":{"repo":"LeeSungKi/leesungki.github.io"}}}}},"pageContext":{"slug":"/gatsby-aws-history-of-opensearch-tuto/","nextSlug":"/gatsby-aws-history-of-opensearch/","prevSlug":"/gatsby-springboot-study-opensearch/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}